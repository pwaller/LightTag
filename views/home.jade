div.content
  div.page-header
    h1 #{title}
      small 
  
  #welcome.container.row
    h2 Welcome!
    .span8
      form#form.well.form-inline(onsubmit="return false;")
        .row
          .span2
            label Who are you?
          .span4
            input#name(type="text", placeholder=".. I am bob")
            //
            button.btn(type="submit") Go!
        .row
          .offset2.span4
            ul.color-chooser
              each color in colors
                li.color(class="labelstyle-#{color}")
                  label
                    input(name="color", type="radio", value="#{color}")
  
  .container.row
    #ncirc 0
    #players.span2
      //div.alert.alert-info
        h4 a
        .progress.progress-success
          .bar(style="width: 50%")
    .span8  
      div#container(style='text-align: center;')// border: 2px solid red;')

footer

script
  $(function () {
    $("#name").focus();
    
    $("#form input[name=color]:first").prop("checked", true).parents("li").addClass("selected");
    
    $(".color-chooser input").click(function () {
      console.log("Clicked! ", $(this).val());
      $(".color-chooser li").removeClass("selected");
      $(this).parents("li").addClass("selected");
    });
    
    $("input,button", this).prop("disabled", false);
    
    $("#form").submit(function (e) {
      e.preventDefault();
      $("#form").off("submit");
      // Prevent duplicate submission:
      $("input,button", this).prop("disabled", true);
      //$("#form").prop("disabled", true);
      
      var name = $("#name").val();
      $("#players").append(
        $("<div>").addClass("alert alert-info")
          .append($("<div>").text("Le " + name))
          .append($("<div>").addClass("progress progress-success")
            .append($("<div>").addClass("bar").attr("style", "width: 20%")))
          
          );
          
      $("#welcome").fadeOut();
      
      canvas_element = init_graphics();
      canvas_element.hide().delay(500).fadeIn();
    });
  });
  
  // set the scene size
  var WIDTH = 640,
    HEIGHT = 480,
    DIAGONAL = Math.sqrt(Math.pow(WIDTH, 2) + Math.pow(HEIGHT, 2));

  function init_graphics() {  
    var container = $('#container');
    
    var renderer = new THREE.WebGLRenderer();
    // TODO(pwaller): Implement fallback, use less points on shells
    //var renderer = new THREE.CanvasRenderer();
    var renderer_element = $(renderer.domElement);
    renderer.setSize(WIDTH, HEIGHT);

    container.append(renderer.domElement);
    renderer.domElement.onselectstart = function () { return false; }
    renderer_element.attr("style", "display:inline; background: black; cursor:none;");
    // border: 2px solid grey; margin: 0 auto");
    
    var scene = new THREE.Scene();
    
    var camera = new THREE.OrthographicCamera(0, WIDTH, 0, HEIGHT, -100, 400);
    scene.add(camera);
        
    var pointLight = new THREE.PointLight(0xFFFFFF);
    pointLight.position.x = WIDTH / 2;
    pointLight.position.y = HEIGHT / 2;
    pointLight.position.z = -130;
    scene.add(pointLight);    
    scene.add(new THREE.AmbientLight(0x000f00));
        
    function animate() {
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }
    
    animate();
    
    var players = {};
    var last_update = 0; 

    function tick_players() {
      window.setTimeout(tick_players, 10);
      
      now = (new Date()).getTime();
      elapsed = now - last_update;
      if (last_update == 0) { 
        last_update = now; 
        return; 
      }
      last_update = now;
      
      for (i in players)
        players[i].tick(elapsed);
    }
    tick_players();
    
    var mycolor = parseInt($("input[name=color]:checked").val(), 16);
    var me = new Player(scene, 0, mycolor);
    players[0] = me;
    
    renderer_element
      .mousemove(function (e) {
        data = [e.pageX - renderer_element.offset().left, e.pageY - renderer_element.offset().top];
        me.move(data);
        socket.emit("move", data);
      })
      .click(function (e) {
        data = [e.pageX - renderer_element.offset().left, e.pageY - renderer_element.offset().top];
      });
      
    
    var socket = io.connect('http://192.168.0.7');
      
    function new_player(who) {
        player = new Player(scene, who, 0xff0000);
        players[player.id] = player;      
    }
    
    socket.on('player connected', new_player);
    
    socket.on('connected players', function (data) {
      for (who in data) {
        new_player(data[who])
      }
    });
    
    socket.on('position update', function (who, where) {
      player = players[who];
      player.move(where);
    });
    
    socket.on('player disconnected', function (who) {
      players[who].gone();
      delete players[who];
    });
    
    return renderer_element;
  }
